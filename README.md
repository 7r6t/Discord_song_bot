# 🎵 بوت Discord للموسيقى

بوت Discord بسيط لتشغيل الموسيقى مع أوامر عربية سهلة الاستخدام.

## ✨ المميزات

* 🎵 تشغيل الأغاني من YouTube
* ⏭️ تخطي الأغاني
* ⏸️ إيقاف مؤقت واستئناف
* 🔁 تكرار الأغاني
* 🛑 إيقاف البوت
* 🧪 اختبار البوت
* 🎨 واجهة جميلة مع Embeds
* 🔧 **جديد: نظام إعادة المحاولة الذكي لحل مشكلة Rate Limiting**
* 🐳 **جديد: إعدادات Docker محسنة مع Health Checks**

## 🚨 **حل مشكلة Rate Limiting من Discord**

### المشكلة:
البوت يواجه خطأ **429 Too Many Requests** من Discord بسبب كثرة الطلبات.

### الحلول المطبقة:
1. **نظام إعادة المحاولة الذكي** - تأخير متزايد بين المحاولات
2. **إعدادات Discord.py محسنة** - استراتيجية تأخير متزايد
3. **إعدادات Docker محسنة** - Health Checks وإدارة الموارد
4. **ملفات تكوين محسنة** - إعدادات Rate Limiting

## 📋 الأوامر

| الأمر          | الوصف                           |
| -------------- | ------------------------------- |
| ش اسم\_الأغنية | تشغيل أغنية (مثال: ش despacito) |
| س              | تخطي الأغنية الحالية            |
| قف             | إيقاف البوت                     |
| كرر            | تكرار الأغنية                   |
| ا              | إيقاف التكرار                   |
| تست            | اختبار البوت                    |
| شوي            | إيقاف مؤقت للأغنية              |
| كمل            | استئناف الأغنية                 |
| يوتيوب         | اختبار الاتصال بـ YouTube       |
| كوكيز          | اختبار Cookies                  |
| كوكيز\_جديد    | إنشاء Cookies جديدة             |
| صلاحيات        | فحص صلاحيات البوت               |
| سيرفر          | فحص إعدادات السيرفر             |
| صوت            | اختبار الاتصال الصوتي           |

## 🚀 التثبيت

### 1\. إنشاء بوت Discord

1. اذهب إلى Discord Developer Portal
2. انقر على "New Application"
3. أعطِ اسم للتطبيق
4. اذهب إلى قسم "Bot"
5. انقر على "Add Bot"
6. انسخ رمز البوت (Token)

### 2\. إعداد البوت

1. في قسم "Bot"، فعّل الخيارات التالية:  
   * Message Content Intent  
   * Server Members Intent  
   * Presence Intent
2. في قسم "OAuth2 > URL Generator":  
   * اختر "bot" من Scopes  
   * اختر الصلاحيات التالية:  
         * Send Messages  
         * Use Slash Commands  
         * Connect  
         * Speak  
         * Use Voice Activity

### 3\. دعوة البوت

انسخ الرابط المُنشأ وافتحه في المتصفح، ثم اختر السيرفر الذي تريد إضافة البوت إليه.

## ⚙️ التكوين

1. افتح ملف `config.py`
2. استبدل `your_discord_bot_token_here` برمز البوت الخاص بك

```python
DISCORD_TOKEN = "your_actual_bot_token_here"
```

## 🐳 النشر على Render.com

### الطريقة الأولى: استخدام Docker (مُحسنة)

1. ارفع الكود إلى GitHub
2. اربط GitHub بـ Render.com
3. اختر "New Web Service"
4. اختر المستودع
5. Render سيقوم ببناء وتشغيل البوت تلقائياً

**مميزات Docker الجديدة:**
- Health Checks تلقائية
- إدارة الموارد المحسنة
- نظام السجلات المحسن
- إعادة التشغيل التلقائي

### الطريقة الثانية: النشر المباشر

1. في Render.com، اختر "New Web Service"
2. اربط GitHub
3. اختر المستودع
4. في Environment Variables، أضف:  
   * `DISCORD_TOKEN`: رمز البوت الخاص بك
5. Build Command: `pip install -r requirements.txt`
6. Start Command: `python main.py`

## 📁 هيكل الملفات

```
├── main.py              # الكود الرئيسي للبوت (مُحسن)
├── config.py            # ملف التكوين (مُحسن)
├── requirements.txt     # المكتبات المطلوبة
├── Dockerfile          # ملف Docker (مُحسن)
├── docker-compose.yml  # ملف Docker Compose (مُحسن)
├── start.sh            # سكريبت التشغيل (مُحسن)
├── render.yaml         # تكوين Render.com
└── README.md           # هذا الملف
```

## 🔧 المتطلبات

* Python 3.8+
* discord.py
* yt-dlp
* PyNaCl
* ffmpeg

## 🔐 حل مشكلة YouTube

### مشكلة "Sign in to confirm you're not a bot"

YouTube يكتشف البوت ويطلب تسجيل الدخول. لحل هذه المشكلة:

#### الطريقة الأولى: اختبار Cookies

```
كوكيز
```

هذا الأمر يختبر إذا كانت Cookies تعمل.

#### الطريقة الثانية: إنشاء Cookies جديدة (محلياً فقط)

```
كوكيز_جديد
```

هذا الأمر يحاول استخراج Cookies من Chrome تلقائياً.

**⚠️ ملاحظة:** هذا الأمر يعمل محلياً فقط. على Render.com، استخدم الطريقة الثالثة.

#### الطريقة الثالثة: يدوياً

1. ثبت extension "Get cookies.txt" في Chrome
2. اذهب إلى YouTube
3. انقر على Extension ثم "Export"
4. احفظ الملف كـ `youtube_cookies.txt`

### ملاحظات مهمة

* تأكد من تسجيل دخولك في YouTube
* استخدم حساب شخصي وليس حساب عمل
* أعد إنشاء Cookies كل فترة

### 🚀 **للنشر على Render.com:**

1. **لا يمكن استخدام أمر `كوكيز_جديد`** (لأن Chrome غير مثبت)
2. **استخدم الطريقة الثالثة (يدوياً):**  
   * ثبت extension "Get cookies.txt" في Chrome  
   * اذهب إلى YouTube  
   * انقر على Extension ثم "Export"  
   * احفظ الملف كـ `youtube_cookies.txt`  
   * ارفع الملف مع الكود إلى GitHub
3. **أو استخدم Cookies الموجودة بالفعل** في `youtube_cookies.txt`

### 📝 **ملف Cookies المثال:**

* يوجد ملف `youtube_cookies_example.txt` في المستودع
* استبدل `[YOUR_COOKIE_VALUE]` بالقيم الحقيقية
* أعد تسمية الملف إلى `youtube_cookies.txt`
* ارفع الملف مع الكود

## 🚨 استكشاف الأخطاء

### البوت لا يستجيب

* تأكد من أن رمز البوت صحيح
* تأكد من تفعيل Message Content Intent

### لا يمكن تشغيل الصوت

* تأكد من أن البوت لديه صلاحية "Connect" و "Speak"
* تأكد من وجود ffmpeg

### مشاكل في البحث

* تأكد من أن yt-dlp محدث
* تحقق من اتصال الإنترنت
* استخدم أمر `كوكيز` لاختبار Cookies

### **مشكلة Rate Limiting (429 Too Many Requests)**

**الأعراض:**
```
discord.errors.HTTPException: 429 Too Many Requests
```

**الحلول:**
1. **انتظار تلقائي:** البوت سينتظر تلقائياً ويحاول مرة أخرى
2. **تغيير IP:** استخدم خادم مختلف أو VPN
3. **تقليل الطلبات:** تأكد من عدم تشغيل نسخ متعددة من البوت

## 📝 ملاحظات

* البوت يحتاج إلى ffmpeg مثبت على النظام
* تأكد من أن البوت لديه الصلاحيات المطلوبة في السيرفر
* البوت يدعم تشغيل أغنية واحدة في كل سيرفر في نفس الوقت
* **جديد:** البوت يتعامل تلقائياً مع Rate Limiting من Discord

## 🤝 المساهمة

نرحب بالمساهمات! يرجى إنشاء Issue أو Pull Request.

## 📄 الرخصة

هذا المشروع مفتوح المصدر ومتاح للجميع.

---

**ملاحظة**: تأكد من اتباع شروط خدمة Discord وYouTube عند استخدام هذا البوت.

## 🔄 **آخر تحديث:**
- ✅ إضافة نظام إعادة المحاولة الذكي
- ✅ تحسين إعدادات Docker
- ✅ إضافة Health Checks
- ✅ حل مشكلة Rate Limiting
- ✅ تحسين ملفات التكوين 